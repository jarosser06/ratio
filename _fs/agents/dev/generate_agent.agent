{
  "description": "Analyzes agent development requests for feasibility and generates the agent if feasible. Uses pessimistic analysis to ensure requests are achievable with available capabilities in 5-7 steps.",
  "arguments": [
    {
      "name": "request",
      "type_name": "string",
      "description": "The agent development request to analyze",
      "required": true
    },
    {
      "name": "agent_directory_mapping",
      "type_name": "string",
      "description": "The agent capability mapping from generate_agent_directory_mapping",
      "required": true
    },
    {
      "name": "agent_name",
      "type_name": "string", 
      "description": "Name for the new agent (without .agent extension)",
      "required": true
    },
    {
      "name": "output_directory",
      "type_name": "string",
      "description": "Directory where the agent should be saved",
      "required": true
    },
    {
      "name": "authoring_manual",
      "type_name": "file",
      "description": "The agent authoring manual with best practices",
      "required": true
    }
  ],
  "instructions": [
    {
      "execution_id": "feasibility_analysis",
      "agent_definition_path": "/agents/core/bedrock_text.agent",
      "transform_arguments": {
        "variables": {
          "prompt_sections": [
            "AGENT FEASIBILITY ANALYSIS",
            "",
            "User Request:",
            "REF:arguments.request",
            "",
            "Available Agent Capabilities:",
            "REF:arguments.agent_directory_mapping",
            "",
            "Authoring Manual:",
            "REF:arguments.authoring_manual",
            "",
            "Analyze this request pessimistically. Only mark as feasible if you can see a clear 5-7 step implementation path using existing agents. Missing capabilities or overly complex workflows should be marked not feasible.",
            "",
            "Respond with exactly this format:",
            "FEASIBILITY: [FEASIBLE or NOT_FEASIBLE]",
            "REASONING: [Your analysis]",
            "SUGGESTED_APPROACH: [Implementation steps if feasible, or missing capabilities if not]"
          ]
        },
        "transforms": {
          "prompt": "join(array=prompt_sections, separator=\"\\n\")"
        }
      },
      "arguments": {
        "model_id": "anthropic.claude-sonnet-4-20250514-v1:0",
        "max_tokens": 2000,
        "temperature": 0.1
      }
    },
    {
      "execution_id": "generate_creation_prompt",
      "agent_definition_path": "/agents/core/bedrock_text.agent",
      "conditions": [
        {"param": "REF:feasibility_analysis.response", "operator": "contains", "value": "FEASIBILITY: FEASIBLE"}
      ],
      "transform_arguments": {
        "variables": {
          "prompt_sections": [
            "AGENT DEFINITION GENERATION",
            "",
            "Original Request:",
            "REF:arguments.request",
            "",
            "Available Agents:",
            "REF:arguments.agent_directory_mapping",
            "",
            "Authoring Manual:",
            "REF:arguments.authoring_manual",
            "",
            "Feasibility Analysis:",
            "REF:feasibility_analysis.response",
            "",
            "Generate a complete JSON agent definition that fulfills the request. Follow the patterns in the authoring manual exactly. Use proper REF strings, dependencies, and conditional logic as needed. Output only valid JSON."
          ]
        },
        "transforms": {
          "prompt": "join(array=prompt_sections, separator=\"\\n\")"
        }
      },
      "arguments": {
        "model_id": "anthropic.claude-sonnet-4-20250514-v1:0",
        "max_tokens": 4000,
        "temperature": 0.1
      }
    },
    {
      "execution_id": "validate_generated_agent",
      "agent_definition_path": "/agents/core/bedrock_text.agent", 
      "conditions": [
        {"param": "REF:feasibility_analysis.response", "operator": "contains", "value": "FEASIBILITY: FEASIBLE"}
      ],
      "transform_arguments": {
        "variables": {
          "prompt_sections": [
            "AGENT DEFINITION VALIDATION",
            "",
            "Generated Agent Definition:",
            "REF:generate_creation_prompt.response",
            "",
            "Authoring Manual:",
            "REF:arguments.authoring_manual",
            "",
            "Validate this agent definition against the authoring manual. Check for:",
            "- Proper JSON structure",
            "- Correct REF usage",
            "- Appropriate dependencies",
            "- Following composition patterns",
            "- Schema compliance",
            "",
            "Respond with exactly:",
            "VALIDATION: [PASS or FAIL]",
            "ISSUES: [List any problems found]",
            "FINAL_AGENT: [The corrected agent definition if needed, otherwise repeat the original]"
          ]
        },
        "transforms": {
          "prompt": "join(array=prompt_sections, separator=\"\\n\")"
        }
      },
      "arguments": {
        "model_id": "anthropic.claude-3-5-sonnet-20241022-v1:0",
        "max_tokens": 4000,
        "temperature": 0.1
      }
    },
    {
      "execution_id": "save_agent_file",
      "agent_definition_path": "/agents/core/put_file.agent",
      "conditions": [
        {"param": "REF:feasibility_analysis.response", "operator": "contains", "value": "FEASIBILITY: FEASIBLE"},
        {"param": "REF:validate_generated_agent.response", "operator": "contains", "value": "VALIDATION: PASS"}
      ],
      "transform_arguments": {
        "variables": {
          "path_components": [
            "REF:arguments.output_directory",
            "/",
            "REF:arguments.agent_name",
            ".agent"
          ]
        },
        "transforms": {
          "file_path": "join(array=path_components, separator=\"\")"
        }
      },
      "arguments": {
        "file_type": "ratio::agent_definition",
        "data": "REF:generate_creation_prompt.response"
      }
    }
  ],
  "responses": [
    {
      "name": "feasibility_result",
      "type_name": "string",
      "description": "The feasibility analysis result",
      "required": true
    },
    {
      "name": "agent_file_path",
      "type_name": "string",
      "description": "Path to the created agent file (null if not created)",
      "required": false
    },
    {
      "name": "validation_result",
      "type_name": "string",
      "description": "Validation result for the generated agent (null if not feasible)",
      "required": false
    }
  ],
  "response_reference_map": {
    "feasibility_result": "REF:feasibility_analysis.response",
    "agent_file_path": "REF:save_agent_file.file_path",
    "validation_result": "REF:validate_generated_agent.response"
  }
}